"use strict";(self.webpackChunk_serverless_sharp_docs=self.webpackChunk_serverless_sharp_docs||[]).push([[4],{5318:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(7378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),c=r,k=d["".concat(p,".").concat(c)]||d[c]||m[c]||l;return n?a.createElement(k,i(i({ref:t},u),{},{components:n})):a.createElement(k,i({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9631:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>l,metadata:()=>o,toc:()=>s});var a=n(5773),r=(n(7378),n(5318));const l={sidebar_position:2},i="Configuration",o={unversionedId:"configuration",id:"configuration",title:"Configuration",description:"Serverless Sharp stores its settings in YAML files. When deploying the application, you specify the YAML file and the",source:"@site/docs/configuration.md",sourceDirName:".",slug:"/configuration",permalink:"/serverless-sharp/docs/configuration",draft:!1,editUrl:"https://github.com/venveo/serverless-sharp/tree/master/docs/docs/configuration.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Quick Start",permalink:"/serverless-sharp/docs/intro"},next:{title:"Deployment",permalink:"/serverless-sharp/docs/deployment"}},p={},s=[{value:"Settings File Structure",id:"settings-file-structure",level:2},{value:"Environment Settings",id:"environment-settings",level:2},{value:"<code>CUSTOM_DOMAIN</code>",id:"custom_domain",level:3},{value:"<code>ACM_CERTIFICATE_ARN</code>",id:"acm_certificate_arn",level:3},{value:"<code>DEFAULT_CACHE_CONTROL</code>",id:"default_cache_control",level:3},{value:"<code>DEFAULT_COMPRESS_QUALITY</code>",id:"default_compress_quality",level:3},{value:"<code>DEFAULT_QUALITY</code>",id:"default_quality",level:3},{value:"<code>MAX_IMAGE_HEIGHT</code>",id:"max_image_height",level:3},{value:"<code>MAX_IMAGE_WIDTH</code>",id:"max_image_width",level:3},{value:"<code>PNGQUANT_SPEED</code>",id:"pngquant_speed",level:3},{value:"<code>SECURITY_KEY</code>",id:"security_key",level:3},{value:"<code>SOURCE_BUCKET</code>",id:"source_bucket",level:3},{value:"<code>SLS_IGNORE</code>",id:"sls_ignore",level:3},{value:"<code>SLS_VALID_PATH_REGEX</code>",id:"sls_valid_path_regex",level:3}],u=(m="Note",function(e){return console.warn("Component "+m+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",e)});var m;const d={toc:s};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Serverless Sharp stores its settings in YAML files. When deploying the application, you specify the YAML file and the\nstage (your environment). For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-shell-session"},"serverless deploy --settings mysite.com.yml --stage prod\n")),(0,r.kt)("h2",{id:"settings-file-structure"},"Settings File Structure"),(0,r.kt)("p",null,"We use YML files to make use of their inheritance. This allows us to define some defaults and then branch environment\n-specific changes off of them. You can define multiple environments, each of which will inherit your default settings.\nThis is useful if you have different buckets for staging & production. You may also wish to create an\nenvironment without a sign-key for local development. For example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"defaults: &defaults\n  serviceName: image-handler\n  region: 'us-east-1'\n  environment: &defaults.environment\n    DEFAULT_QUALITY: 75\n    DEFAULT_COMPRESS_QUALITY: 45\n    SLS_IGNORE: favicon.ico\n    SLS_VALID_PATH_REGEX: '.*'\n    MAX_IMAGE_WIDTH: 2000\n    MAX_IMAGE_HEIGHT: 1000\n    PNGQUANT_SPEED: 10\n    SOURCE_BUCKET: 'images.mydomain.com'\n    DEFAULT_CACHE_CONTROL: 'max-age=2592000'\n\nstages:\n  dev:\n    <<: *defaults\n    environment:\n      <<: *defaults.environment\n      SECURITY_KEY: ''\n      CUSTOM_DOMAIN: ''\n      ACM_CERTIFICATE_ARN: ''\n  prod:\n    <<: *defaults\n    environment:\n      <<: *defaults.environment\n      SECURITY_KEY: 'random-string-here'\n      CUSTOM_DOMAIN: 'img.mydomain.com'\n      ACM_CERTIFICATE_ARN: ''\n")),(0,r.kt)("h2",{id:"environment-settings"},"Environment Settings"),(0,r.kt)("p",null,"The majority of the application and environment specific settings are configured as environment variables that are\npassed into the Lambda service handler."),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Setting"),(0,r.kt)("th",{parentName:"tr",align:null},"Default"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#custom_domain"},"CUSTOM_DOMAIN")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"empty"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"[ACM_CERTIFICATE_ARN]",")(#acm_certificate_arn)"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"empty"),"]")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#default_cache_control"},"DEFAULT_CACHE_CONTROL")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"empty"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#default_compress_quality"},"DEFAULT_COMPRESS_QUALITY")),(0,r.kt)("td",{parentName:"tr",align:null},"75")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#default_quality"},"DEFAULT_QUALITY")),(0,r.kt)("td",{parentName:"tr",align:null},"75")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#max_image_height"},"MAX_IMAGE_HEIGHT")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"2000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#max_image_width"},"MAX_IMAGE_WIDTH")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"2000"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#pngquant_speed"},"PNGQUANT_SPEED")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"10"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#security_key"},"SECURITY_KEY")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"empty"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#source_bucket"},"SOURCE_BUCKET")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"empty"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#sls_ignore"},"SLS_IGNORE")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("em",{parentName:"td"},"empty"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"#sls_valid_path_regex"},"SLS_VALID_PATH_REGEX")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},".*"))))),(0,r.kt)("h3",{id:"custom_domain"},(0,r.kt)("inlineCode",{parentName:"h3"},"CUSTOM_DOMAIN")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"string")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("em",{parentName:"li"},"empty"))),(0,r.kt)("p",null,"If set, Serverless Sharp will generate an Amazon issued certificate for the domain and link it to your Cloudfront\ndistribution."),(0,r.kt)(u,{type:"tip",mdxType:"Note"},(0,r.kt)("p",null,"This requires deployment in the ",(0,r.kt)("inlineCode",{parentName:"p"},"us-east-1")," region!")),(0,r.kt)(u,{type:"tip",mdxType:"Note"},(0,r.kt)("p",null,"During deployment, you'll need to go into your Amazon ACM console and verify the domain.")),(0,r.kt)("h3",{id:"acm_certificate_arn"},(0,r.kt)("inlineCode",{parentName:"h3"},"ACM_CERTIFICATE_ARN")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"type: ",(0,r.kt)("inlineCode",{parentName:"li"},"string")),(0,r.kt)("li",{parentName:"ul"},"DEFAULT: ",(0,r.kt)("em",{parentName:"li"},"empty"))),(0,r.kt)("p",null,"Use an existing ACM Certificate, by supplying the ACM Certificate Arn."),(0,r.kt)("h3",{id:"default_cache_control"},(0,r.kt)("inlineCode",{parentName:"h3"},"DEFAULT_CACHE_CONTROL")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"string")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("em",{parentName:"li"},"empty"))),(0,r.kt)("p",null,"By default, Serverless Sharp will serve responses with the same Cache-Control header as the object being served. If\nthe Cache-Control header is not set, this value will be used."),(0,r.kt)("h3",{id:"default_compress_quality"},(0,r.kt)("inlineCode",{parentName:"h3"},"DEFAULT_COMPRESS_QUALITY")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"integer")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("inlineCode",{parentName:"li"},"75"))),(0,r.kt)("p",null,"A number between 1 and 100 for the default quality when an image is requested to be compressed"),(0,r.kt)("h3",{id:"default_quality"},(0,r.kt)("inlineCode",{parentName:"h3"},"DEFAULT_QUALITY")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"integer")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("inlineCode",{parentName:"li"},"75"))),(0,r.kt)("h3",{id:"max_image_height"},(0,r.kt)("inlineCode",{parentName:"h3"},"MAX_IMAGE_HEIGHT")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"integer")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("inlineCode",{parentName:"li"},"2000"))),(0,r.kt)("p",null,"Images may not be requested with a height larger than this value"),(0,r.kt)("h3",{id:"max_image_width"},(0,r.kt)("inlineCode",{parentName:"h3"},"MAX_IMAGE_WIDTH")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"integer")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("inlineCode",{parentName:"li"},"2000"))),(0,r.kt)("p",null,"Images may not be requested with a width larger than this value"),(0,r.kt)("h3",{id:"pngquant_speed"},(0,r.kt)("inlineCode",{parentName:"h3"},"PNGQUANT_SPEED")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"integer")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("inlineCode",{parentName:"li"},"10"))),(0,r.kt)("p",null,"The speed value to pass to the ",(0,r.kt)("inlineCode",{parentName:"p"},"pngquant")," optimization program. From the ",(0,r.kt)("a",{parentName:"p",href:"https://pngquant.org/"},"pngquant website"),":"),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Speed/quality trade-off from 1 (brute-force) to 10 (fastest). The default is 3. Speed 10 has 5% lower quality, but is 8 times faster than the default.")),(0,r.kt)("h3",{id:"security_key"},(0,r.kt)("inlineCode",{parentName:"h3"},"SECURITY_KEY")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"string")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("em",{parentName:"li"},"empty"))),(0,r.kt)("p",null,"If set, a hash must be provided as the ",(0,r.kt)("inlineCode",{parentName:"p"},"s")," parameter in all requests. See ",(0,r.kt)("a",{parentName:"p",href:"/serverless-sharp/docs/usage/security"},"Security")," for more."),(0,r.kt)("h3",{id:"source_bucket"},(0,r.kt)("inlineCode",{parentName:"h3"},"SOURCE_BUCKET")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"string")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("em",{parentName:"li"},"empty"))),(0,r.kt)("p",null,"The S3 bucket in your account where your images are stored - you can include a path here if you like. For example\n: ",(0,r.kt)("inlineCode",{parentName:"p"},"mybucket/images")),(0,r.kt)("p",null,"This will tell Serverless to create an IAM role with access to all objects in the ",(0,r.kt)("inlineCode",{parentName:"p"},"mybucket")," bucket with an object prefix\nof ",(0,r.kt)("inlineCode",{parentName:"p"},"images"),"."),(0,r.kt)("p",null,"Serverless Sharp will then validate all requests to this prefix, if it doesn't start with that prefix, the system\nwill automatically prepend it to the request. This means these requests are effectively equivalent:"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"localhost/images/my-image.png")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"localhost/my-image.png")),(0,r.kt)("h3",{id:"sls_ignore"},(0,r.kt)("inlineCode",{parentName:"h3"},"SLS_IGNORE")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"string")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("em",{parentName:"li"},"empty"))),(0,r.kt)("p",null,"A comma-delineated string of paths that should be ignored (for example, ",(0,r.kt)("inlineCode",{parentName:"p"},"favicon.ico"),")"),(0,r.kt)("h3",{id:"sls_valid_path_regex"},(0,r.kt)("inlineCode",{parentName:"h3"},"SLS_VALID_PATH_REGEX")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"Regular Expression")),(0,r.kt)("li",{parentName:"ul"},"Default: ",(0,r.kt)("inlineCode",{parentName:"li"},".*"))),(0,r.kt)("p",null,"A regular expression for path validation. Allows you to explicitly control what assets may be handled by the Lambda\nfunction. If the request path fails this test, a 404 response will be served."),(0,r.kt)("p",null,"Example:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"# All requests must start with /images/\nSLS_VALID_PATH_REGEX: ^\\/images\\/.*`\n")))}c.isMDXComponent=!0}}]);